<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HMS 3.0 - Reception</title>
  
  <link rel="stylesheet" href="/shared/css/variables.css">
  <link rel="stylesheet" href="/shared/css/layout.css">
  <link rel="stylesheet" href="/shared/css/components.css">
  <link rel="stylesheet" href="/reception/css/reception.css">
  <link rel="stylesheet" href="/reception/css/modals.css">
  <link rel="stylesheet" href="/reception/css/forms.css">
  <link rel="stylesheet" href="/reception/css/components.css">
</head>
<body>

  <div class="reception-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo sidebar-text">HMS 3.0</div>
        <div class="sidebar-subtitle sidebar-text">Reception</div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-item active" data-tab="dashboard">
          <span class="nav-icon">üìä</span>
          <span class="sidebar-text">Dashboard</span>
        </div>
        <div class="nav-item" data-tab="register">
          <span class="nav-icon">üìù</span>
          <span class="sidebar-text">Register Patient</span>
        </div>
        <div class="nav-item" data-tab="records">
          <span class="nav-icon">üìã</span>
          <span class="sidebar-text">View Records</span>
        </div>
        <div class="nav-item" data-tab="legacy-viewer">
          <span class="nav-icon">üìö</span>
          <span class="sidebar-text">Legacy Data</span>
        </div>
        <div class="nav-item" data-tab="import-export">
          <span class="nav-icon">üì§</span>
          <span class="sidebar-text">Import/Export</span>
        </div>
	<div class="nav-item" data-tab="opd-entry">
  	  <span class="nav-icon">üè•</span>
  	  <span class="sidebar-text">OPD Entry</span>
	</div>
      </nav>

      <div class="sidebar-footer">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">R</div>
          <div class="user-details sidebar-text">
            <div class="user-name" id="userName">Reception</div>
            <div class="user-role" id="userRole">Staff</div>
          </div>
        </div>
        <a href="/logout" class="btn btn-ghost w-full sidebar-text" style="text-align: center;">Logout</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Queue Stats -->
      <div class="queue-stat">
        <div class="queue-stat-value" id="queueCount">-</div>
        <div class="queue-stat-label">Patients in Queue</div>
      </div>

      <!-- Dashboard Tab with Smart Search -->
      <section id="dashboard" class="tab-content active">
        <div class="modern-card">
          <div class="modern-card-header">
            <h2>üîç Smart Search</h2>
          </div>
          <div class="modern-card-body">
            <div class="dashboard-search-row">
  <div class="search-bar-container">
    <input type="text" id="smartSearchInput" class="search-input-main" 
           placeholder="Search by RegNo, Name, Mobile...">
  </div>
  <button class="btn-register-new" onclick="Registration.openModal()">
    + Register New Patient
  </button>
</div>
<div id="smartSearchResults"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Register Tab -->
      <section id="register" class="tab-content">
        <div class="modern-card">
          <div class="modern-card-header">
            <h2>üìù Patient Registration</h2>
          </div>
          <div class="modern-card-body">
            <form id="registerForm">
              <div class="registration-form">
                <!-- Row 1: RegNo (2) : Name (8) -->
                <div class="form-row" style="grid-template-columns: 2fr 8fr;">
                  <div class="form-group">
                    <label class="form-label">RegNo</label>
                    <input type="text" class="form-input" id="displayRegNo" disabled style="background: #f0f4ff; font-weight: 700; color: #667eea; text-align: center;">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Patient Name <span class="required-star">*</span></label>
                    <input type="text" class="form-input" id="name" required placeholder="ENTER FULL NAME">
                  </div>
                </div>

                <!-- Row 2: DOB (2) : Age (2) : Gender (2) : Mobile (4) -->
                <div class="form-row" style="grid-template-columns: 2fr 2fr 2fr 4fr;">
                  <div class="form-group">
                    <label class="form-label">Date of Birth</label>
                    <input type="date" class="form-input" id="dob">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Age</label>
                    <div class="age-display" id="ageDisplay" style="width: 100%; height: 48px; display: flex; align-items: center; justify-content: center;">-</div>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Gender <span class="required-star">*</span></label>
                    <select class="form-select" id="gender" required>
                      <option value="">Select...</option>
                      <option value="M">MALE</option>
                      <option value="F">FEMALE</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="form-label">Mobile Number <span class="required-star">*</span></label>
                    <input type="tel" class="form-input" id="mobile" required maxlength="10" placeholder="10 DIGITS">
                    <div class="mobile-status" id="mobileStatus"></div>
                  </div>
                </div>

                <!-- Row 3: Father (3) : Mother (3) : Address (4) -->
                <div class="form-row" style="grid-template-columns: 3fr 3fr 4fr;">
                  <div class="form-group">
                    <label class="form-label">Father's Name</label>
                    <input type="text" class="form-input" id="father" placeholder="OPTIONAL">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Mother's Name</label>
                    <input type="text" class="form-input" id="mother" placeholder="OPTIONAL">
                  </div>
                  <div class="form-group">
                    <label class="form-label">Address <span class="required-star">*</span></label>
                    <textarea class="form-textarea" id="address" required placeholder="COMPLETE ADDRESS" style="height: 48px;"></textarea>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn-modern btn-secondary" id="clearFormBtn">üóëÔ∏è Clear Form</button>
                <button type="submit" class="btn-modern btn-primary">‚úÖ Register Patient</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Last Registration -->
        <div class="last-registration" id="lastRegistration" style="display: none;">
          <div class="last-registration-title">‚ú® Last Registered Patient</div>
          <div class="last-registration-grid" id="lastRegistrationDetails"></div>
        </div>
      </section>

      <!-- Search Tab -->
      <!-- Legacy Data Viewer Tab -->
      <section id="legacy-viewer" class="tab-content">
        <div class="modern-card">
          <div class="modern-card-header">
            <h2>üìö Legacy Data Viewer (HMS 2.0)</h2>
            <div style="display: flex; gap: 8px;">
              <button class="btn-modern btn-secondary" id="printLegacyBtn">üñ®Ô∏è Print</button>
              <button class="btn-modern btn-primary" id="exportLegacyCsvBtn">üì• Export CSV</button>
            </div>
          </div>
          <div class="modern-card-body">
            <!-- Table Selector -->
            <div class="records-tabs">
              <button class="records-tab active" data-legacy-table="vaccines">üíâ Vaccine Register</button>
              <button class="records-tab" data-legacy-table="followup">üìÖ Follow-up Register</button>
            </div>

            <!-- Filters -->
            <form id="legacyFilterForm">
              <div class="filters-basic">
                <div class="filter-group">
                  <label>Search:</label>
                  <input type="text" class="form-input" id="legacySearchFilter" placeholder="RegNo, Name, Mobile...">
                </div>

                <div style="display: flex; gap: 12px;">
                  <button type="submit" class="btn-modern btn-primary">Search</button>
                  <button type="button" class="btn-modern btn-secondary" onclick="document.getElementById('legacyFilterForm').reset(); LegacyViewer.loadRecords();">Clear</button>
                </div>
              </div>
            </form>

            <!-- Sort & Per Page -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
              <div style="display: flex; gap: 12px; align-items: center;">
                <label>Sort:</label>
                <select class="form-select" id="legacySortBySelect" style="width: 150px;">
                  <option value="id">Newest First</option>
                  <option value="regno">RegNo</option>
                  <option value="name">Name</option>
                </select>
                <button class="btn-modern btn-secondary" id="legacySortOrderBtn" data-order="DESC" style="width: 50px;">‚Üì</button>
              </div>

              <div style="display: flex; gap: 8px; align-items: center;">
                <label>Per Page:</label>
                <select class="form-select" id="legacyPerPageSelect" style="width: 80px;">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>
            </div>

            <!-- Table Container -->
            <div id="legacyTableContainer"></div>

            <!-- Pagination -->
            <div id="legacyPaginationContainer" style="margin-top: 20px;"></div>
          </div>
        </div>
      </section>

      <!-- Import/Export Tab -->
      <section id="import-export" class="tab-content">
        <!-- Current Data Import/Export -->
        <h2 style="margin-bottom: 20px; color: #1e293b; font-size: 20px;">üìä Current Data Import/Export</h2>
        
        <div class="import-export-grid">
          <!-- Export Card -->
          <div class="import-export-card">
            <h3>üì• Export Data</h3>
            <p style="color: #64748b; margin-bottom: 16px;">Download records as CSV file.</p>
            
            <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block;">Select Table:</label>
            <select class="form-select" id="exportTableSelect" style="margin-bottom: 12px;">
              <option value="patients">Patients</option>
              <option value="op-register">OP Register</option>
              <option value="vaccines">Vaccines</option>
              <option value="followup">Follow-up</option>
            </select>
            
            <button class="btn-modern btn-primary w-full" id="exportAllBtn">üì• Download CSV</button>
          </div>

          <!-- Import Card -->
          <div class="import-export-card">
            <h3>üì§ Import Data</h3>
            <p style="color: #64748b; margin-bottom: 16px;">Upload CSV file to import records.</p>
            
            <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block;">Select Table:</label>
            <select class="form-select" id="importTableSelect" style="margin-bottom: 12px;">
              <option value="patients">Patients</option>
              <option value="op-register">OP Register</option>
              <option value="vaccines">Vaccines</option>
              <option value="followup">Follow-up</option>
            </select>
            
            <input type="file" id="importCsvFile" accept=".csv" class="form-input" style="margin-bottom: 12px;">
            
            <button class="btn-modern btn-secondary w-full" id="downloadTemplateBtn" style="margin-bottom: 12px;">
              üìÑ Download Template
            </button>
            
            <button class="btn-modern btn-primary w-full" id="importAllBtn">üì§ Import CSV</button>
          </div>
        </div>

        <!-- Import Summary -->
        <div id="importAllSummary"></div>

        <!-- Legacy Import Section -->
        <div style="margin-top: 48px; padding-top: 32px; border-top: 3px solid #e2e8f0;">
          <h2 style="margin-bottom: 12px; color: #1e293b; font-size: 20px;">üï∞Ô∏è Legacy Data Import (HMS 2.0)</h2>
          <p style="color: #64748b; margin-bottom: 24px; font-size: 14px;">
            Import historical data from your previous HMS 2.0 system. Legacy data is stored separately for reference.
          </p>

          <div class="import-export-grid">
            <div class="import-export-card" style="background: #fef3c7; border: 2px solid #fbbf24;">
              <h3 style="color: #92400e;">‚ö†Ô∏è Legacy Import Instructions</h3>
              <div style="color: #78350f; font-size: 13px; line-height: 1.6;">
                <p style="margin-bottom: 8px;"><strong>Before importing:</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 12px;">
                  <li>Import Patients first</li>
                  <li>Then import OP Register, Vaccines, Follow-ups</li>
                  <li>Legacy data stored separately</li>
                  <li>OP numbers converted to new format</li>
                  <li>Patient snapshots preserved in vaccine/followup legacy tables</li>
                </ul>
                <p style="font-weight: 600; margin-top: 12px;">‚ö° Status defaults: Completed & Paid</p>
              </div>
            </div>

            <div class="import-export-card">
              <h3>üì§ Import Legacy Data</h3>
              <p style="color: #64748b; margin-bottom: 16px;">Upload HMS 2.0 CSV files.</p>
              
              <label style="font-size: 13px; font-weight: 600; margin-bottom: 8px; display: block;">Select Data Type:</label>
              <select class="form-select" id="legacyTableSelect" style="margin-bottom: 12px;">
                <option value="op-register">OP Register</option>
                <option value="vaccines">Vaccines</option>
                <option value="followup">Follow-up</option>
              </select>
              
              <input type="file" id="legacyCsvFile" accept=".csv" class="form-input" style="margin-bottom: 12px;">
              
              <button class="btn-modern btn-secondary w-full" id="downloadLegacyTemplateBtn" style="margin-bottom: 12px;">
                üìÑ Download Legacy Template
              </button>
              
              <button class="btn-modern btn-primary w-full" id="importLegacyBtn">üì§ Import Legacy Data</button>
            </div>
          </div>

          <!-- Legacy Import Summary -->
          <div id="legacyImportSummary"></div>
        </div>
      </section>

      <!-- Records Viewer Tab -->
      <section id="records" class="tab-content">
        <div class="modern-card">
          <div class="modern-card-header">
            <h2>üìã View Records</h2>
            <div style="display: flex; gap: 8px;">
              <button class="btn-modern btn-secondary" id="printBtn">üñ®Ô∏è Print</button>
              <button class="btn-modern btn-primary" id="exportCsvBtn">üì• Export CSV</button>
            </div>
          </div>
          <div class="modern-card-body">
            <!-- Table Selector Tabs -->
            <div class="records-tabs">
              <button class="records-tab active" data-table="patients">Patients</button>
              <button class="records-tab" data-table="op-register">OP Register</button>
              <button class="records-tab" data-table="vaccines">Vaccines</button>
              <button class="records-tab" data-table="followup">Follow-up</button>
            </div>

            <!-- Filters - All in Single Line -->
            <form id="recordsFilterForm">
              <div style="display: grid; grid-template-columns: 140px 130px 130px 1fr auto auto; gap: 8px; align-items: center; margin-bottom: 20px;">
                <!-- Date Quick Filter -->
                <select class="form-select" id="dateQuickFilter">
                  <option value="">All Dates</option>
                  <option value="today">Today</option>
                  <option value="yesterday">Yesterday</option>
                  <option value="last7days">Last 7 Days</option>
                  <option value="last30days">Last 30 Days</option>
                  <option value="custom">Custom Range</option>
                </select>

                <!-- From Date (Always Visible) -->
                <input type="date" class="form-input" id="dateFrom" placeholder="From">

                <!-- To Date (Always Visible) -->
                <input type="date" class="form-input" id="dateTo" placeholder="To">

                <!-- Search Box (Stretches) -->
                <input type="text" class="form-input" id="searchFilter" placeholder="RegNo, Name, Mobile...">

                <!-- Action Buttons -->
                <button type="submit" class="btn-modern btn-primary">Apply</button>
                <button type="button" class="btn-modern btn-secondary" onclick="ViewRecords.clearFilters()">Clear</button>
              </div>

              <!-- Table-Specific Filters (Second Line, Compact) -->
              <div id="tableSpecificFilters" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                <!-- OP Register Filters -->
                <div id="opFilters" style="display: none;">
                  <select class="form-select" id="doctorFilter">
                    <option value="">All Doctors</option>
                  </select>
                </div>
                <div id="opFilters2" style="display: none;">
                  <input type="text" class="form-input" id="complaintsFilter" placeholder="Chief Complaints...">
                </div>

                <!-- Vaccine Filters -->
                <div id="vaccineFilters" style="display: none; grid-column: 1 / -1;">
                  <input type="text" class="form-input" id="vaccineBrandFilter" placeholder="Vaccine Brand...">
                </div>

                <!-- Follow-up Filters -->
                <div id="followupFilters" style="display: none; grid-column: 1 / -1;">
                  <input type="text" class="form-input" id="followupReasonFilter" placeholder="Follow-up Reason...">
                </div>
              </div>
            </form>

            <!-- Sort & Per Page -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0;">
              <div style="display: flex; gap: 12px; align-items: center;">
                <label>Sort By:</label>
                <select class="form-select" id="sortBySelect" style="width: 150px;">
                  <option value="id">Newest First</option>
                  <option value="regno">RegNo</option>
                  <option value="name">Name</option>
                </select>
                <button class="btn-modern btn-secondary" id="sortOrderBtn" data-order="DESC" style="width: 50px;">‚Üì</button>
              </div>

              <div style="display: flex; gap: 8px; align-items: center;">
                <label>Per Page:</label>
                <select class="form-select" id="perPageSelect" style="width: 80px;">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                </select>
              </div>
            </div>

            <!-- Table Container -->
            <div id="recordsTableContainer"></div>

            <!-- Pagination -->
            <div id="paginationContainer" style="margin-top: 20px;"></div>
          </div>
        </div>
      </section>

<!-- OPD Entry Tab -->
<section id="opd-entry" class="tab-content">
  <!-- Today's Stats -->
  <div class="opd-stats-grid">
    <div class="opd-stat-card stat-total">
      <div class="stat-icon">üìä</div>
      <div class="stat-value" id="opdTodayTotal">0</div>
      <div class="stat-label">Total Today</div>
    </div>
    <div class="opd-stat-card stat-new">
      <div class="stat-icon">üÜï</div>
      <div class="stat-value" id="opdTodayNew">0</div>
      <div class="stat-label">New Visits</div>
    </div>
    <div class="opd-stat-card stat-review">
      <div class="stat-icon">üîÑ</div>
      <div class="stat-value" id="opdTodayReview">0</div>
      <div class="stat-label">Reviews</div>
    </div>
    <div class="opd-stat-card stat-emergency">
      <div class="stat-icon">üö®</div>
      <div class="stat-value" id="opdTodayEmergency">0</div>
      <div class="stat-label">Emergency</div>
    </div>
    <div class="opd-stat-card stat-waiting">
      <div class="stat-icon">‚è≥</div>
      <div class="stat-value" id="opdTodayWaiting">0</div>
      <div class="stat-label">Waiting</div>
    </div>
  </div>

  <div class="modern-card">
    <div class="modern-card-header">
      <h2>üè• OPD Entry</h2>
    </div>
    <div class="modern-card-body">
      <!-- Patient Search Section -->
      <div class="opd-search-section">
        <h3 class="opd-section-title">1Ô∏è‚É£ Select Patient</h3>
        <div class="search-input-wrapper">
          <input 
            type="text" 
            id="opdPatientSearch" 
            class="search-input" 
            placeholder="Search by RegNo, Name, Mobile..."
          >
        </div>
        <div id="opdPatientResults"></div>
      </div>

      <!-- Selected Patient Details -->
      <div id="opdSelectedPatient" class="opd-selected-patient" style="display: none;">
        <div class="opd-section-header">
          <h3 class="opd-section-title">üìã Patient Details</h3>
          <button type="button" class="btn-clear-selection" onclick="OPDEntry.clearPatientSelection()">
            ‚úñÔ∏è Clear Selection
          </button>
        </div>
        <div class="patient-details-display">
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">RegNo:</span>
              <span class="detail-value" id="opdSelectedRegno">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Name:</span>
              <span class="detail-value" id="opdSelectedName">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Age:</span>
              <span class="detail-value" id="opdSelectedAge">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Gender:</span>
              <span class="detail-value" id="opdSelectedGender">-</span>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item">
              <span class="detail-label">Father:</span>
              <span class="detail-value" id="opdSelectedFather">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Mother:</span>
              <span class="detail-value" id="opdSelectedMother">-</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Mobile:</span>
              <span class="detail-value" id="opdSelectedMobile">-</span>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-item" style="grid-column: 1 / -1;">
              <span class="detail-label">Address:</span>
              <span class="detail-value" id="opdSelectedAddress">-</span>
            </div>
          </div>
        </div>

        <!-- Previous Visits -->
        <div id="opdPreviousVisits" class="opd-previous-section" style="display: none;">
          <h4 class="opd-subsection-title">üìÖ Recent Visits</h4>
          <div id="opdVisitsList"></div>
        </div>
      </div>

      <!-- OPD Entry Form -->
      <form id="opdEntryForm">
        <div class="opd-form-section">
          <h3 class="opd-section-title">2Ô∏è‚É£ Visit Information</h3>
          
          <div class="form-group">
            <label class="form-label">Doctor <span class="required">*</span></label>
            <select id="opdDoctor" class="form-select" required>
              <option value="">Select Doctor</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Visit Type <span class="required">*</span></label>
            <div class="visit-type-button-group">
              <button type="button" class="visit-type-btn active" data-type="new">
                üÜï New Visit
              </button>
              <button type="button" class="visit-type-btn" data-type="review" disabled title="Select patient first">
                üîÑ Review
              </button>
              <button type="button" class="visit-type-btn" data-type="emergency">
                üö® Emergency
              </button>
            </div>
            <div id="reviewBadge" class="review-badge" style="display: none;"></div>
          </div>
        </div>

        <div class="opd-form-section">
          <h3 class="opd-section-title">3Ô∏è‚É£ Vitals (Optional)</h3>
          
          <div class="form-row" style="grid-template-columns: repeat(3, 1fr);">
            <div class="form-group">
              <label class="form-label">BP (mmHg)</label>
              <input type="text" id="opdBP" class="form-input" placeholder="120/80">
            </div>

            <div class="form-group">
              <label class="form-label">Temperature (¬∞F)</label>
              <input type="number" id="opdTemp" class="form-input" step="0.1" placeholder="98.6">
            </div>

            <div class="form-group">
              <label class="form-label">Pulse (bpm)</label>
              <input type="number" id="opdPulse" class="form-input" placeholder="72">
            </div>
          </div>

          <div class="form-row" style="grid-template-columns: repeat(3, 1fr);">
            <div class="form-group">
              <label class="form-label">RR (breaths/min)</label>
              <input type="number" id="opdRR" class="form-input" placeholder="16">
            </div>

            <div class="form-group">
              <label class="form-label">SpO‚ÇÇ (%)</label>
              <input type="number" id="opdSPO2" class="form-input" min="0" max="100" placeholder="98">
            </div>

            <div class="form-group">
              <label class="form-label">Weight (kg)</label>
              <input type="number" id="opdWeight" class="form-input" step="0.1" placeholder="70">
            </div>
          </div>

          <div class="form-row" style="grid-template-columns: repeat(3, 1fr);">
            <div class="form-group">
              <label class="form-label">Height (cm)</label>
              <input type="number" id="opdHeight" class="form-input" step="0.1" placeholder="170">
            </div>

            <div class="form-group">
              <label class="form-label">HC (cm)</label>
              <input type="number" id="opdHC" class="form-input" step="0.1" placeholder="Head Circumference">
            </div>

            <div class="form-group">
              <label class="form-label">MUAC (cm)</label>
              <input type="number" id="opdMUAC" class="form-input" step="0.1" placeholder="Mid-Upper Arm">
            </div>
          </div>
        </div>

        <div class="opd-form-section">
          <h3 class="opd-section-title">4Ô∏è‚É£ Chief Complaints <span class="required">*</span></h3>
          
          <div class="form-group">
            <label class="form-label">Select Complaints</label>
            <div class="complaints-dropdown-container">
              <div class="complaints-dropdown-trigger" onclick="OPDEntry.toggleComplaintsDropdown()">
                <span id="selectedComplaintsDisplay">Select complaints...</span>
                <span class="dropdown-arrow">‚ñº</span>
              </div>
              <div id="complaintsDropdownContent" class="complaints-dropdown-content">
                <div class="complaints-checkbox-list" id="complaintsCheckboxList">
                  <!-- Checkboxes will be populated by JS -->
                </div>
                <div class="add-complaint-section">
                  <input 
                    type="text" 
                    id="newComplaintInput" 
                    class="form-input" 
                    placeholder="Type new complaint..."
                    style="margin-bottom: 8px;"
                  >
                  <button type="button" class="btn-add-complaint" onclick="OPDEntry.addNewComplaint()">
                    ‚ûï Add to List
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Previous Complaints (Optional)</label>
            <textarea id="opdPreviousComplaints" class="form-textarea" rows="2" placeholder="Previous complaints if any..."></textarea>
          </div>
        </div>

        <div class="opd-form-section">
          <h3 class="opd-section-title">5Ô∏è‚É£ Fee & Payment</h3>
          
          <!-- Fee Breakdown Card -->
          <div class="fee-breakdown-card" id="feeBreakdownCard">
            <div class="fee-breakdown-header">Fee Breakdown</div>
            <div class="fee-breakdown-body">
              <div class="fee-item">
                <span>Consultation Fee:</span>
                <span id="feeConsultation">‚Çπ0.00</span>
              </div>
              <div class="fee-item">
                <span>Emergency Surcharge:</span>
                <span id="feeSurcharge">‚Çπ0.00</span>
              </div>
              <div class="fee-item fee-total">
                <span>Total:</span>
                <span id="feeTotal">‚Çπ0.00</span>
              </div>
            </div>
          </div>

          <div class="form-row" style="grid-template-columns: repeat(2, 1fr); margin-top: 20px;">
            <div class="form-group">
              <label class="form-label">Override Amount (Optional)</label>
              <input type="number" id="opdOverrideFee" class="form-input" step="0.01" min="0" placeholder="Leave blank to use calculated fee">
            </div>

            <div class="form-group">
              <label class="form-label">Final Amount</label>
              <div class="final-amount-display" id="opdFinalAmount">‚Çπ0.00</div>
            </div>
          </div>

          <!-- Payment Details -->
          <div class="payment-section">
            <h4 class="opd-subsection-title">Payment Details</h4>
            
            <div class="form-group">
              <label class="form-label">Payment Method</label>
              <div class="payment-method-group">
                <label class="payment-method-option">
                  <input type="radio" name="paymentMethod" value="Cash">
                  <span>üíµ Cash</span>
                </label>
                <label class="payment-method-option">
                  <input type="radio" name="paymentMethod" value="UPI">
                  <span>üì± UPI</span>
                </label>
                <label class="payment-method-option">
                  <input type="radio" name="paymentMethod" value="Card">
                  <span>üí≥ Card</span>
                </label>
                <label class="payment-method-option">
                  <input type="radio" name="paymentMethod" value="Other">
                  <span>üè¶ Other</span>
                </label>
              </div>
            </div>

            <div class="form-row" style="grid-template-columns: repeat(3, 1fr);">
              <div class="form-group">
                <label class="form-label">Amount to Pay</label>
                <div class="amount-display" id="opdAmountToPay">‚Çπ0.00</div>
              </div>

              <div class="form-group">
                <label class="form-label">Amount Paid</label>
                <input type="number" id="opdPaidAmount" class="form-input" step="0.01" min="0" value="0" placeholder="0.00">
              </div>

              <div class="form-group">
                <label class="form-label">Balance</label>
                <div class="amount-display balance-display" id="opdBalance">‚Çπ0.00</div>
              </div>
            </div>
          </div>

          <!-- Hidden field to store calculated fee -->
          <input type="hidden" id="opdConsultationFeeHidden" value="0">
        </div>

        <div class="opd-form-actions">
          <button type="button" id="clearOPDBtn" class="btn-modern btn-secondary">
            üóëÔ∏è Clear Form
          </button>
          <button type="button" id="printOPSlipBtn" class="btn-modern btn-secondary">
            üñ®Ô∏è Print OP Slip
          </button>
          <button type="submit" class="btn-modern btn-primary">
            üíæ Save Entry
          </button>
        </div>
      </form>
    </div>
  </div>
</section>


    </main>
  </div>

  <!-- Edit Patient Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal-container">
      <div class="modal-header">
        <h2>‚úèÔ∏è Edit Patient</h2>
        <button class="modal-close" id="closeEditModal">√ó</button>
      </div>
      <div class="modal-body">
        <form id="editForm">
          <input type="hidden" id="editPatientId">
          
          <div class="modal-form-grid">
            <div class="form-group full">
              <label class="form-label">RegNo</label>
              <input type="text" class="form-input" id="editRegno" disabled style="background: #f1f5f9;">
            </div>
            
            <div class="form-group">
              <label class="form-label">Name <span class="required-star">*</span></label>
              <input type="text" class="form-input" id="editName" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Date of Birth</label>
              <input type="date" class="form-input" id="editDob">
            </div>
            
            <div class="form-group">
              <label class="form-label">Gender <span class="required-star">*</span></label>
              <select class="form-select" id="editGender" required>
                <option value="M">MALE</option>
                <option value="F">FEMALE</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Mobile <span class="required-star">*</span></label>
              <input type="tel" class="form-input" id="editMobile" required maxlength="10">
              <div class="mobile-status" id="editMobileStatus"></div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Father's Name</label>
              <input type="text" class="form-input" id="editFather">
            </div>
            
            <div class="form-group">
              <label class="form-label">Mother's Name</label>
              <input type="text" class="form-input" id="editMother">
            </div>
            
            <div class="form-group full">
              <label class="form-label">Address <span class="required-star">*</span></label>
              <textarea class="form-textarea" id="editAddress" required style="height: 60px;"></textarea>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-actions">
        <button class="btn-modern btn-secondary" id="cancelEditBtn">Cancel</button>
        <button class="btn-modern btn-primary" id="saveEditBtn">üíæ Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Records Detail Modal -->
  <div class="modal-overlay" id="recordDetailModal">
    <div class="modal-container" style="max-width: 900px;">
      <div class="modal-header">
        <h2 id="recordModalTitle">üìã Record Details</h2>
        <button class="modal-close" id="closeRecordModal">√ó</button>
      </div>
      <div class="modal-body" id="recordModalBody">
        <!-- Content loaded dynamically -->
      </div>
      <div class="modal-actions">
        <button class="btn-modern btn-secondary" id="closeRecordModalBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Core Libraries -->
  <script src="/shared/js/api.js"></script>
  <script src="/shared/js/utils.js"></script>
  
  <!-- Utilities -->
  <script src="/reception/js/receptionUtils.js"></script>
  
  <!-- Templates (load before logic) -->
  <script src="/reception/js/registrationTemplates.js"></script>
  <script src="/reception/js/opdTemplates.js"></script>
  
  <!-- Tab-based Modules -->
  <script src="/reception/js/navigation.js"></script>
  <script src="/reception/js/register.js"></script>
  <script src="/reception/js/smartSearch.js"></script>
  <script src="/reception/js/viewRecords.js"></script>
  <script src="/reception/js/legacyViewer.js"></script>
  <script src="/reception/js/importExport.js"></script>
  <script src="/reception/js/bugfixes.js"></script>
  <script src="/reception/js/opdEntry.js"></script>
  
  <!-- Modal-based Modules -->
  <script src="/reception/js/registration.js"></script>
  <script src="/reception/js/opdEntryModal.js"></script>
  
  <!-- Main Initialization -->
  <script src="/reception/js/main.js"></script>

</body>
</html>
